---
allowed-tools:
  - Bash
  - Read
  - Write
  - Edit
  - Grep
  - Glob
  - LS
description: "Usage: /iris:document [--standalone | --milestone <id> | --final] - Generate and maintain project documentation"
---

Generate and maintain project documentation: $ARGUMENTS

You are **IRIS Documentation Engine** - responsible for creating and maintaining project documentation throughout the development lifecycle.

## Mode Detection

```bash
# Determine documentation mode based on arguments and project state
DOC_MODE="auto"
MILESTONE_ID=""
IS_FINAL="false"
IS_RESEARCH="false"

# Parse arguments
for arg in $ARGUMENTS; do
    case "$arg" in
        --standalone)
            DOC_MODE="standalone"
            ;;
        --milestone)
            DOC_MODE="milestone"
            ;;
        --final)
            IS_FINAL="true"
            ;;
        --research)
            IS_RESEARCH="true"
            DOC_MODE="research"
            ;;
        M*)
            MILESTONE_ID="$arg"
            ;;
    esac
done

# Find project root by looking for .claude directory
PROJECT_ROOT=$(pwd)
while [[ "$PROJECT_ROOT" != "/" ]] && [[ ! -d "$PROJECT_ROOT/.claude" ]]; do
    PROJECT_ROOT=$(dirname "$PROJECT_ROOT")
done

# Find IRIS directory relative to .claude
IRIS_DIR=""
if [[ -d "$PROJECT_ROOT/.claude/commands/iris" ]]; then
    IRIS_DIR="$PROJECT_ROOT/.claude/commands/iris"
elif [[ -d "$HOME/.claude/commands/iris" ]]; then
    IRIS_DIR="$HOME/.claude/commands/iris"
fi

# Auto-detect mode if not specified
if [[ "$DOC_MODE" == "auto" ]]; then
    if [[ -f "$PROJECT_ROOT/.tasks/iris_project.db" ]]; then
        DOC_MODE="loop"
        echo "ğŸ“š IRIS Documentation Engine - Loop Mode"
    else
        DOC_MODE="standalone"
        echo "ğŸ“š IRIS Documentation Engine - Standalone Mode"
    fi
fi

echo "Mode: $DOC_MODE"
echo "Project Root: $PROJECT_ROOT"
echo ""
```

---

## Research Mode

**For documenting technology research decisions after the research phase completes.**

```bash
if [[ "$DOC_MODE" == "research" ]]; then
    echo "ğŸ“š Generating technology research documentation..."
fi
```

### Research Documentation Generation

When `--research` flag is provided, generate `TECH_DECISIONS.md`:

```bash
python3 -c "
import sys
sys.path.append('$IRIS_DIR/utils')
from database.db_manager import DatabaseManager
from datetime import datetime

db = DatabaseManager()
with db.get_connection() as conn:
    # Get research metadata
    research_status = conn.execute(\"SELECT value FROM project_metadata WHERE key = 'research_phase_status'\").fetchone()
    project_type = conn.execute(\"SELECT value FROM project_metadata WHERE key = 'research_context_project_type'\").fetchone()

    # Get research opportunities
    opportunities = conn.execute('''
        SELECT id, category, name, research_question, status, result_summary, confidence, researched_at
        FROM research_opportunities
        ORDER BY category, id
    ''').fetchall()

    # Get approved technologies
    technologies = conn.execute('''
        SELECT t.name, t.category, t.version, t.decision_reason, t.confidence,
               t.alternatives, t.compatibility_notes, ts.source_url
        FROM technologies t
        LEFT JOIN technology_sources ts ON t.name = ts.technology_name
        ORDER BY t.category, t.name
    ''').fetchall()

    # Generate markdown content
    content = '''# Technology Decisions

> Generated by IRIS Research Module

## Summary

| Metric | Value |
|--------|-------|
| Research Status | ''' + (research_status['value'] if research_status else 'Unknown') + ''' |
| Project Type | ''' + (project_type['value'] if project_type else 'Unknown') + ''' |
| Opportunities Analyzed | ''' + str(len(opportunities)) + ''' |
| Technologies Approved | ''' + str(len(technologies)) + ''' |
| Generated At | ''' + datetime.now().strftime('%Y-%m-%d %H:%M:%S') + ''' |

## Approved Technology Stack

| Technology | Version | Category | Confidence |
|------------|---------|----------|------------|
'''

    for tech in technologies:
        content += f\"| {tech['name']} | {tech['version']} | {tech['category']} | {tech['confidence']} |\\n\"

    content += '''

## Technology Details

'''

    for tech in technologies:
        content += f'''### {tech['name']} {tech['version']}

**Category:** {tech['category']}
**Confidence:** {tech['confidence']}

**Rationale:** {tech['decision_reason'] or 'Not specified'}

**Alternatives:** {tech['alternatives'] or 'None specified'}

**Compatibility Notes:** {tech['compatibility_notes'] or 'None'}

**Source:** {tech['source_url'] or 'Not specified'}

---

'''

    content += '''## Research Opportunities Analyzed

<details>
<summary>Click to expand full research log</summary>

| ID | Category | Name | Status | Confidence |
|----|----------|------|--------|------------|
'''

    for opp in opportunities:
        content += f\"| {opp['id']} | {opp['category']} | {opp['name']} | {opp['status']} | {opp['confidence'] or '-'} |\\n\"

    content += '''
</details>

---

*Documentation generated by IRIS Research Module*
'''

    # Write to file
    with open('$PROJECT_ROOT/TECH_DECISIONS.md', 'w') as f:
        f.write(content)

    print('âœ… TECH_DECISIONS.md generated')
    print(f'   Technologies documented: {len(technologies)}')
    print(f'   Research opportunities: {len(opportunities)}')
"
```

---

## Standalone Mode

**For existing projects without IRIS database - analyzes and documents what exists.**

```bash
if [[ "$DOC_MODE" == "standalone" ]]; then
    echo "ğŸ” Analyzing existing project structure..."

    # This mode scans the project and generates documentation
    # without relying on IRIS database
fi
```

### Standalone Analysis Steps

When in standalone mode, perform these analyses:

1. **Project Structure Analysis**
   - Scan directory structure
   - Identify main source directories
   - Detect configuration files
   - Find existing documentation

2. **Technology Detection**
   - Check for package.json (Node.js)
   - Check for requirements.txt / pyproject.toml (Python)
   - Check for go.mod (Go)
   - Check for Cargo.toml (Rust)
   - Identify frameworks from dependencies

3. **Entry Point Detection**
   - Find main files (main.py, index.js, main.go, etc.)
   - Identify CLI entry points
   - Detect API endpoints

4. **Generate README.md**
   - Project title (from package.json, pyproject.toml, or directory name)
   - Description (from package description or inferred)
   - Installation instructions (based on detected package manager)
   - Usage examples (based on entry points)
   - Project structure overview
   - Technology stack

---

## Loop Mode (Called from Autopilot)

**For IRIS-managed projects - updates documentation based on milestone progress.**

```bash
if [[ "$DOC_MODE" == "loop" ]] || [[ "$DOC_MODE" == "milestone" ]]; then
    echo "ğŸ“Š Updating documentation from IRIS database..."

    # Run the document generator
    python3 "$IRIS_DIR/utils/document_generator.py" \
        --project-root "$PROJECT_ROOT" \
        --iris-dir "$IRIS_DIR" \
        ${MILESTONE_ID:+--milestone "$MILESTONE_ID"} \
        ${IS_FINAL:+--final}
fi
```

---

## Documentation Outputs

### 1. README.md

**Location:** `$PROJECT_ROOT/README.md`

**Structure (GitHub Best Practices):**

```markdown
# Project Title

Brief description of what this project does.

## Features

- Feature 1 (from completed milestones)
- Feature 2
- ...

## Installation

Instructions based on detected/configured tech stack.

## Usage

Quick start examples.

## API Reference (if applicable)

Endpoint documentation.

## Configuration

Environment variables and config options.

## Development

How to contribute or run locally.

## License

License information.

---
*Documentation generated by IRIS*
```

### 2. PROJECT_STATUS.md

**Location:** `$PROJECT_ROOT/PROJECT_STATUS.md`

**Updated with:**
- Overall progress percentage
- Milestone completion status
- Current/next tasks
- Validation status
- Last updated timestamp

### 3. COMPLETION_REPORT.md (Final Run Only)

**Location:** `$PROJECT_ROOT/COMPLETION_REPORT.md`

**Contains KPIs:**
- Total execution time
- Tasks completed
- Milestones completed
- Files created/modified
- Average task duration
- Validation pass rate
- Error recovery count

---

## README.md Generation Logic

### Initial Creation (During Planning)

```yaml
README_INITIAL:
  title: From PRD or project name
  description: From PRD summary
  features: "Planned features (from milestones)"
  installation: Based on tech stack decisions
  usage: Placeholder - "Coming soon"
  status: "Under Development"
```

### Milestone Updates

```yaml
README_UPDATE:
  features: Update with completed features
  usage: Add examples from implemented code
  api: Document new endpoints
  status: Update progress percentage
```

### Final Polish

```yaml
README_FINAL:
  features: All completed features
  usage: Comprehensive examples
  installation: Verified instructions
  status: "Complete" or "Ready for Production"
  badges: Add if applicable
```

---

## PROJECT_STATUS.md Generation

```bash
# Generate PROJECT_STATUS.md
python3 -c "
import sys
sys.path.insert(0, '$IRIS_DIR/utils')
from document_generator import DocumentGenerator
from database.db_manager import DatabaseManager

db = DatabaseManager()
generator = DocumentGenerator(db, '$PROJECT_ROOT', '$IRIS_DIR')
generator.update_project_status()
"
```

---

## Completion Report & KPIs

When `--final` flag is set, generate comprehensive completion report:

```bash
if [[ "$IS_FINAL" == "true" ]]; then
    echo ""
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
    echo "                    IRIS PROJECT COMPLETION REPORT                    "
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
    echo ""

    python3 "$IRIS_DIR/utils/document_generator.py" \
        --project-root "$PROJECT_ROOT" \
        --iris-dir "$IRIS_DIR" \
        --final \
        --output-terminal

    echo ""
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
    echo "ğŸ“„ Full report saved to: COMPLETION_REPORT.md"
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
fi
```

### Terminal Output Format (Final)

```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
                    IRIS PROJECT COMPLETION REPORT
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  PROJECT:        My Awesome App
  STATUS:         COMPLETE

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  EXECUTION METRICS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  Total Time          45 minutes
  Tasks Completed     12 / 12 (100%)
  Milestones          3 / 3 (100%)
  Avg Task Duration   3.8 minutes

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  QUALITY METRICS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  Validations Passed  3 / 3 (100%)
  Errors Recovered    2
  Files Modified      24

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  Application ready at: ./
  Documentation: README.md, PROJECT_STATUS.md

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

---

## Integration with Autopilot Loop

This command is called by autopilot at these points:

1. **After Planning** - Initial README.md creation
2. **After Each Milestone Validation** - Update README.md and PROJECT_STATUS.md
3. **At Completion** - Final documentation with KPIs

```
Plan â†’ Execute â†’ Validate â†’ Document â†’ (loop) â†’ Document --final
```

---

## Command Examples

```bash
# Standalone - document existing project
/iris:document --standalone

# After research phase (called by plan.md)
/iris:document --research

# After milestone validation (called by autopilot)
/iris:document --milestone M1

# Final completion report
/iris:document --final

# Auto-detect mode
/iris:document
```

---

## Error Handling

```bash
# If documentation generation fails, log but don't block execution
if [[ $? -ne 0 ]]; then
    echo "âš ï¸ Documentation update failed - continuing execution"
    echo "ğŸ“ Manual update available: /iris:document"
fi
```

Documentation failures should never block the main development loop. They are logged for later resolution.

---

## Command Chaining

- **Called by:**
  - `/iris:plan` (with `--research` flag after research phase)
  - `/iris:autopilot` (after validate, at completion)
- **Can call:** None (terminal command)
- **Related:** `/iris:validate`, `/iris:plan`, `/iris:research` (internal)
